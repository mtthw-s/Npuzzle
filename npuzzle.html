<html>
 <!-- N puzzle solver-->
  <head>
    <style>
      input[type="button"]{
        width: 100%;
        height: 100%;
      }
    </style>
    <script type="text/javascript" src="UI.js"></script>
    <script type="text/javascript" src="state.js"></script>
    <script type="text/javascript" src="ai.js"></script>
  </head>
  <body>
    
    <table id=tblPuzzle></table>
    

    <script>
      function getInversionCount(array){
        var count = 0;
        var test = JSON.parse(JSON.stringify(array));
        if(test.indexOf("b") > 0){
          test[test.indexOf("b")] = 9;
        }
        for(var i = 0; i < test.length; i++){
          for(var j = i; j < test.length; j++){
            if(test[i] != "b" && test[j] != "b" && parseInt(test[i]) > parseInt(test[j])){
              count++;
            }
          }
        }
        return count;
      }

      function Shuffle(state){
        
        return AI.ShuffleBoard(state);

      }
      
      function shuffleInplace(a) {
        var j, x, i;
        for (i = a.length - 1; i > 0; i--) {
          j = Math.floor(Math.random() * (i + 1));
          x = a[i];
          a[i] = a[j];
          a[j] = x;
        }
        return a;
      }
      
      
      function run(start, end){
        var init = start.toString();
        UI.DrawBoard(start);
        var final;
        var b = UI.ReadBoard2();
        var newState = AI.createState(b, end);
        //do{
          var path = [];
          var startTime = Date.now();
          newState = AI.makeMove2(newState);
          var time = "Time: " + ((Date.now() - startTime)/1000) + " secs";
          
          UI.DrawBoard(newState.GetflatBoard());
          var ans = [];
          while(newState !== null){
            ans.push(newState);
            newState = newState.parentState;
          }
          for(var j = ans.length - 1; j >= 0; j--){
            UI.DrawBoard(ans[j].GetflatBoard());
            //console.log(ans[j].GetFlatString());
            document.write(ans[j].GetFlatString());
          }
          alert("Solved in " + ans.length + " moves\n" + time);
      }
      
      function Setup(num){
        var end = [];
        var start;
        for(var i = 0; i < num; i++){
          end.push((i + 1).toString());
        }
        end.push("b");
        start = JSON.parse(JSON.stringify(end));
        UI.DrawBoard(start);
        var b = UI.ReadBoard2();
        var state = new State();
        state.board = b;//shuffleInplace(b);
        //debugger;
        state = Shuffle(state);
        return [state.GetflatBoard(), end];
      }
      
      var boards;
      UI.init("tblPuzzle");
      do{
        boards = Setup(8);
      }while(getInversionCount(boards[0]) % 2 !== 0)
      //var initial = boards[0].toString()
      //alert(getInversionCount(boards[0]));
      //console.log(boards[0].toString() + " InvertionCount:" + getInversionCount(boards[0]));
      document.write("Start: " + boards[0].toString() + " InvertionCount:" + getInversionCount(boards[0]));
      run(boards[0], boards[1]);
      
    </script>
 </body>
</html>
