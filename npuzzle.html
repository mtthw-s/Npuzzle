<html>
 <!-- N puzzle solver-->
  <head>
    <style>
      input[type="button"]{
        width: 100%;
        height: 100%;
      }
    </style>
    <script type="text/javascript" src="UI.js"></script>
    <script type="text/javascript" src="state.js"></script>
    <script type="text/javascript" src="ai.js"></script>
  </head>
  <body>
    
    <table id=tblPuzzle></table>
    

    <script>
      function getInversionCount(array){
        var count = 0;
        for(var i = 0; i < array.length; i++){
          for(var j = i; j < array.length; j++){
            if(array[i] != "b" && array[j] != "b" && parseInt(array[i]) > parseInt(array[j])){
              count++;
            }
          }
        }
        return count;
      }
      
      function test(num, start, end){
        for(var i = 0; i < num; i++){
          end.push((i + 1).toString());
        }
        end.push("b");
        start = JSON.parse(JSON.stringify(end));
        start = UI.Shuffle(start);
        return [start, end];
      }

      function Shuffle(state){
        
        return AI.ShuffleBoard(state);

      }
      
      
      function run(start, end){
        UI.DrawBoard(start);
        var b = UI.ReadBoard2();
        var newState = AI.createState(b, end);
        do{
          newState = AI.makeMove(newState);
          
          
          if(newState !== null){
            UI.DrawBoard(newState.GetflatBoard());
            console.log(newState.GetflatBoard() + " score:" + newState.score + " inversion:" + getInversionCount(newState.GetflatBoard()));
          }
          else{
            alert("Your starting array was impossible to solve!");
          }
        }while(newState !== null && newState.score > 0);
      }
      
      function Setup(num){
        var end = [];
        var start;
        for(var i = 0; i < num; i++){
          end.push((i + 1).toString());
        }
        end.push("b");
        start = JSON.parse(JSON.stringify(end));
        UI.DrawBoard(start);
        var b = UI.ReadBoard2();
        var state = new State();
        state.board = b;
        state = Shuffle(state);
        return [state.GetflatBoard(), end];
      }
      
      var boards;
      UI.init("tblPuzzle");
      do{
        boards = Setup(35);//[["1","2","6","5","3","8","b","7","4"],["1","2","3","4","5","6","7","8","b"]];
      }while(getInversionCount(boards[0]) % 2 !== 0)
      
      alert(getInversionCount(boards[0]));
      console.log(boards[0].toString());
      run(boards[0], boards[1]);
      //var boardStart = ["4","1","b","2","8","3","7","6","5"];
      //test(8, boardStart, boardEnd);

      
      
      //console.log(b.join(","));
    </script>
 </body>
</html>
